version: "3"

vars:
  PYTHON: python3
  VENV_DIR: .venv
  SRC_DIR: src
  TESTS_DIR: tests

tasks:
  venv:
    desc: "Creates Python Virtual Environment."
    cmds:
      - "python3 -m venv {{.VENV_DIR}}"
      - "{{.VENV_DIR}}/bin/python -m pip install --upgrade pip"
      - "{{.VENV_DIR}}/bin/python -m pip install -r requirements.txt"
  venv:recreate:
    desc: "Recreates Python virtual environment."
    cmds:
      - "rm -rf {{.VENV_DIR}}"
      - task: venv
  build:
    desc: "Build package distribution"
    cmds:
      - "{{.VENV_DIR}}/bin/python -m build"

  clean:
    desc: "Clean up build artifacts, cache files, and temporary files"
    cmds:
      - rm -rf build/
      - rm -rf dist/
      - rm -rf *.egg-info/
      - rm -rf .pytest_cache/
      - rm -rf htmlcov/
      - rm -rf .coverage
      - rm -rf .ruff_cache/
      - rm -rf src/__pycache__/
      - rm -rf tests/__pycache__/

  build:clean:
    desc: "Clean build artifacts and rebuild"
    cmds:
      - task: clean
      - task: build

  build:install:
    desc: "Clean build artifacts, rebuild it and install in virtual environment."
    cmds:
      - task: build:clean
      - "{{.VENV_DIR}}/bin/python -m pip install dist/*.whl"

  test:cov:
    desc: "Run tests with coverage report"
    cmds:
      - "{{.VENV_DIR}}/bin/python -m pytest"

  test:clean:
    desc: "Clean build artifacts, rebuild it, install in virtual environment and run tests."
    cmds:
      - task: build:install
      - task: test:cov
